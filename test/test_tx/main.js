import * as CardanoWasm from '@emurgo/cardano-serialization-lib-browser';
import { Buffer } from 'buffer';
window.Buffer = Buffer;

document.getElementById('connect').addEventListener('click', async () => {
  const wallet = 'eternl'

  if (!window.cardano || !window.cardano[wallet]) {
    alert("wallet not installed");
    return;
  }

  try {
    const api = await window.cardano[wallet].enable();
    const usedAddresses = await api.getUsedAddresses();

    if (!usedAddresses || usedAddresses.length === 0) {
      alert("addresses not found");
      return;
    }

    const hexAddress = usedAddresses[0];
    const addressBytes = Buffer.from(hexAddress, 'hex');
    const address = CardanoWasm.Address.from_bytes(addressBytes);
    const bech32Address = address.to_bech32();

    let pubKeyHash = 'not-available';

    const baseAddr = CardanoWasm.BaseAddress.from_address(address);
    if (baseAddr) {
      const paymentCred = baseAddr.payment_cred();
      const keyHash = paymentCred.to_keyhash();
      if (keyHash) {
        pubKeyHash = Buffer.from(keyHash.to_bytes()).toString('hex');
      }
    }

    document.getElementById('address').textContent =
      `Address: ${bech32Address}\nPubKeyHash: ${pubKeyHash}`;





    const cborVar = "84aa00d901028482582047e2742416aed65f8aa6b9cdbad71491ce9fc6f10f3380c41163a79de926e29e0082582047e2742416aed65f8aa6b9cdbad71491ce9fc6f10f3380c41163a79de926e29e0182582047e2742416aed65f8aa6b9cdbad71491ce9fc6f10f3380c41163a79de926e29e02825820cd11af680316b46339b880a240ec4b97a42b3c4e6168ce128428cec256d84f1c01018282583901e6e9941e21500bbd678105b569e815197e9f8de6e7ba858c6626ec3168bc106760088a7fa0d217575c2abf35fa1ea197c18520066458f69d821a0011d28aa1581cc1ae188080924df3a9ed0d93798375978400a4f94a98ed71ca002b66a14b746872656164746f6b656e0182583901e6e9941e21500bbd678105b569e815197e9f8de6e7ba858c6626ec3168bc106760088a7fa0d217575c2abf35fa1ea197c18520066458f69d821a0107cf70a1581cd068fe47123ec4c86460eeb74c7d7765c67d2df295a3ac86d664ed45a15818506c757475734669727374436c61737350686f746f32303601021a00052a31031a09a6987f081a09a696db0b58204f665f1c68a42d35eee03db69579139fe1b03a9cfa01cb876147d73c59bd94ef0dd901028182582047e2742416aed65f8aa6b9cdbad71491ce9fc6f10f3380c41163a79de926e29e010ed9010281581ce6e9941e21500bbd678105b569e815197e9f8de6e7ba858c6626ec311082583901e6e9941e21500bbd678105b569e815197e9f8de6e7ba858c6626ec3168bc106760088a7fa0d217575c2abf35fa1ea197c18520066458f69d1a008d24d0111a001e8480a20581840000d9050080821a000162551a019429ff07d9010281590cc4590cc10101003333333333232323232323223223223223223223223223223225333014323232323253323301a3001301b37540042646644646464646464a66604660080022a66604c604a6ea80300085854ccc08cc02800454ccc098c094dd50060010b0a99981198028008a99981318129baa00c00216153330233006001132325333028302b00200416375a6052002604a6ea803054ccc08cc00c00454ccc098c094dd50060010b0a99981199b874802800454ccc098c094dd50060010b0a99981199b874803000454ccc098c094dd50060010b0a99981199b874803800454ccc098c094dd50060010b0b18119baa00b1533302130023022375400a26464646464646464646464646464a646660606022008264646464a666068602a606a6ea80044c8c94ccc0d8c05cc0dcdd50008991919299981c8048a99981c8040a99981c8038a99981c80108008a5014a0294052819baf30093303c4c0108d8799f20d87a80ff004bd701805981d1baa0023300d30123756602a60726ea80040d4c0ecc0e0dd50008b198069bac30083037375403e466ebcc040c0e0dd50009808181c1baa3014303837540046072606c6ea800458cc02cdd61806981a9baa01d23375e601c606c6ea8004064cc020dd61804981a1baa01c02a325333032301930333754002266e20090dd6981b981a1baa00114a0601660666ea8c02cc0ccdd5180198199baa01b3011375a606a60646ea8c0d403c4c94ccc0c4c0600144c8c8c8c94ccc0d4c058c0d8dd500089919299981b980c181c1baa001132323232533303b00a1533303b0091533303b0081533303b0031533303b002100114a029405280a5014a066ebcc02ccc0f9300108d8799f01d87a80ff004bd701806981e1baa0033370e60126eacc05cc0ecdd50010179980718099bab3016303a375400206c607860726ea800458cc038dd61804981c1baa02023375e602260726ea8004c044c0e4dd5180a981c9baa002303a303737540022c660186eb0c038c0d8dd500f119baf300f30373754002034660126eb0c028c0d4dd500e816992999819980d181a1baa0011337106eb4c0e0c0d4dd50008128a50300c30343754601860686ea8c010c0d0dd500e18091bad303630333754606c0202a666062602600a264646464a66606a602c606c6ea80044c8c94ccc0dcc060c0e0dd50008991919299981d0048a99981d0040a99981d0038a99981d00108008a5014a0294052819baf300a3303d4c108d8799f21d87a80ff004bd701806181d9baa0023300e30133756602c60746ea80040d8c0f0c0e4dd50008b198071bac300930383754040466ebcc044c0e4dd50009808981c9baa3015303937540046074606e6ea800458cc030dd61807181b1baa01e23375e601e606e6ea8004068cc024dd61805181a9baa01d02b325333033301a30343754002266e2008cdd6981c181a9baa00114a0601860686ea8c030c0d0dd51802181a1baa01c3018375a606c60666ea8c0d804054c8ccc0c8c0540184cc88c8c8c8c8c8c94ccc0e8c06cc0ecdd500089919299981e180e981e9baa001132323232533304000c1533304000b1533304000a153330400081533304000315333040002100114a029405280a5014a02940cdd7980819821980c19821a6101020033043301833043375001897ae04bd7025eb80c048c104dd500199b87300e3756603860806ea80080d0cc04cc060dd5980d981f9baa00103b3041303e37540022c660266eb0c038c0f4dd5012919baf3016303e3754002602c607c6ea8c068c0f8dd5001181f981e1baa00116330113758602660766ea808c8cdd7980a181e1baa00101f53330383371005000a20022940cdc41803002012998061bac300d3038375404006064a66606c603a606e6ea80044cdc41bad303b3038375400204c2940c03cc0dcdd51807981b9baa30073037375403e60360046eb4c0dcc0d0dd5181b8089bad30373034375400e2a666064602400c264664464646464a666072603460746ea80044c8c94ccc0ecc070c0f0dd5000899191919299981f8050a99981f8048a99981f8040a99981f8018a99981f80108008a5014a029405280a503375e601e6608498108d8799f22d87a80ff004bd70180898201baa0033370e601a6eacc06cc0fcdd500101999809180b9bab301a303e37540020746080607a6ea800458cc048dd61806981e1baa02423375e602a607a6ea8004c054c0f4dd5180c981e9baa002303e303b37540022c660206eb0c048c0e8dd5011119baf3013303b375400203c6601a6eb0c038c0e4dd501081799299981b980f181c1baa001132533303830193039375400826464a66607466e2000800c400452819b880023008001375a607a60746ea80105281bad303c303937540022940c040c0e0dd51808181c1baa300830383754040602e0046eb4c0e0004c0e0c0e4004c0d0dd5181b8088a99981919b87480280184c8cc88c8c8c94ccc0e0c064c0e4dd500089919299981d180d981d9baa001132323232533303e0091533303e0081533303e0031533303e002100114a029405280a503375e601c66082602c660829801010300330410094bd7025eb80c040c0fcdd500199b87300c37566034607c6ea80080c8cc044c058dd5980c981e9baa001039303f303c37540022c660226eb0c030c0ecdd5011919baf3014303c3754002602860786ea8c060c0f0dd5001181e981d1baa001163300f3758602260726ea80848cdd79809181d1baa00101d3300c3758601a60706ea80800b8c05c008dd6981c000981c181c800981a1baa3037011153330323370e9006003099199119191919299981c980d181d1baa00113232533303b301c303c3754002264646464a66607e0142a66607e0122a66607e0102a66607e0062a66607e004200229405280a5014a02940cdd7980799821260108d8799f04d87a80ff004bd70180898201baa00333712062601a6eacc06cc0fcdd500119809180b9bab301a303e37540020746080607a6ea800458cc048dd61806981e1baa02423375e602a607a6ea8004c054c0f4dd5180c981e9baa002303e303b37540022c660206eb0c048c0e8dd5011119baf3013303b375400203c64a666070603e60726ea80044c94ccc0e4c068c0e8dd5002899299981d180e003899b88300900100214a26eb4c0f8c0ecdd50028a50375a607a60746ea80045281808981c9baa301130393754601260726ea8084cc030dd61806981c1baa0200305333035301800214a22602e0046eb4c0e0004c0e0c0e4004c0d0dd5181b808899191919299981b180b981b9baa001132533303700415333037003100114a02940cc030c044dd5980a181c1baa301430383754607660706ea80040d058cc034dd61807981b9baa01f23375e602060706ea800406ccc028dd61805981b1baa01e03053330333370e00290008a51153330333370e00290018a51153330333370e00290028a5113013001375a606e60686ea8c0dc044dc02410121c98008464a666064603260666ea8004520001375a606e60686ea8004c94ccc0c8c064c0ccdd50008a60103d87a80001323300100137566070606a6ea8008894ccc0dc004530103d87a800013233322253330383372291100003153330383371e910100003130113303c375000497ae014c0103d87a8000133006006001375c606c0026eb4c0dc004c0ec008c0e4004c8cc004004008894ccc0d80045300103d87a800013233322253330373372291100003153330373371e910100003130103303b374c00497ae014c0103d87a8000133006006001375c606a0026eacc0d8004c0e8008c0e0004dd2a400846068606a606a606a606a606a606a606a0024606660686068002605a6ea8004c0c0c0c402888c8cc00400400c894ccc0c400452809991299981819b8f00200514a22660080080026eb8c0cc004c0d00048c0bcc0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c000488c8cc00400400c894ccc0bc004530103d87a800013322533302e300500213007330320024bd70099802002000981880098190009ba5480008c0b00048c008004c004004894ccc0a000452f5c0266052604c60540026600400460560024605060520026604a604c60466ea8014cc0940292f5c02c6e1d2008370e90001b8748010dc3a400c60400026040604200260386ea8008dc3a40042c603a603c006603800460360046036002602c6ea800452613656375a0026eb4004dd68009bad001375a0026eb8004dd70009bae001375c002ae6955ceaab9e5573eae815d0aba24c11e581cc1ae188080924df3a9ed0d93798375978400a4f94a98ed71ca002b66004c011e581ce6e9941e21500bbd678105b569e815197e9f8de6e7ba858c6626ec31004c011e581cf01c268c791d627b59a02fb293ba423038e97b23ed88a3d37ffa203c004c011e581ce6e9941e21500bbd678105b569e815197e9f8de6e7ba858c6626ec31004c01051a00aba950004c01051a00112a88004c01091b00000198436b0571004c01091b0000019848916171004c01091b000001997d8ef1710001f5f6"
    
  } catch (error) {
    console.error("error connection wallet:", error);
    alert("error connecting wallet");
  }
});
